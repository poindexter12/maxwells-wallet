---
phase: 14-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .devcontainer/devcontainer.json
  - .devcontainer/post-create.sh
  - .github/workflows/devcontainer.yaml
autonomous: true
requirements: [DEVC-01, DEVC-02, DEVC-03]

must_haves:
  truths:
    - "Devcontainer uses mise feature instead of separate node/python features"
    - "postCreateCommand runs mise trust, mise install, and just setup"
    - "Tools (node, python, uv, just, gum) are available in new terminal sessions inside the container"
    - "Devcontainer workflow validates mise and just are installed"
  artifacts:
    - path: ".devcontainer/devcontainer.json"
      provides: "Devcontainer config with mise feature"
      contains: "ghcr.io/jdx/mise/mise"
    - path: ".devcontainer/post-create.sh"
      provides: "Updated post-create script using just"
      contains: "just setup"
    - path: ".github/workflows/devcontainer.yaml"
      provides: "Devcontainer CI test with mise/just checks"
      contains: "just --version"
  key_links:
    - from: ".devcontainer/devcontainer.json"
      to: ".mise.toml"
      via: "mise feature reads tool versions from .mise.toml"
      pattern: "ghcr.io/jdx/mise/mise"
    - from: ".devcontainer/post-create.sh"
      to: "justfile"
      via: "just setup recipe runs install + db init + db seed"
      pattern: "just setup"
---

<objective>
Update the devcontainer configuration to use mise for tool management instead of separate node/python devcontainer features, and update the devcontainer CI workflow to validate the new tooling.

Purpose: Ensure devcontainer matches local dev environment — single source of truth for tool versions via .mise.toml, single setup command via just.

Output: Updated devcontainer.json, post-create.sh, and devcontainer.yaml workflow.
</objective>

<execution_context>
@/Users/joe/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-integration/14-RESEARCH.md

<interfaces>
<!-- Current devcontainer.json features to replace -->
Current features:
- ghcr.io/devcontainers/features/node:1 (version: "24")
- ghcr.io/devcontainers/features/python:1 (version: "3.11")
- ghcr.io/devcontainers/features/github-cli:1

Replace node + python features with:
- ghcr.io/jdx/mise/mise:latest

Keep github-cli feature (not managed by mise).

<!-- From justfile root -->
`just setup` runs: install → db::init → db::seed
This is the single entry point for devcontainer setup.

<!-- From .mise.toml (Phase 12) -->
.mise.toml manages: node, python, uv, just, gum
mise activate adds tools to PATH in shell sessions.
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update devcontainer.json and post-create.sh for mise</name>
  <files>
    .devcontainer/devcontainer.json
    .devcontainer/post-create.sh
  </files>
  <action>
**Update `.devcontainer/devcontainer.json`:**

Replace the features section:
```json
"features": {
  "ghcr.io/jdx/mise/mise:latest": {},
  "ghcr.io/devcontainers/features/github-cli:1": {}
}
```
- Remove `ghcr.io/devcontainers/features/node:1` (mise manages node)
- Remove `ghcr.io/devcontainers/features/python:1` (mise manages python)
- Keep `ghcr.io/devcontainers/features/github-cli:1` (not managed by mise)
- Add `ghcr.io/jdx/mise/mise:latest` (manages node, python, uv, just, gum)

Update `postCreateCommand`:
```json
"postCreateCommand": "mise trust && mise install && just setup"
```
- `mise trust` — required on first container build to trust .mise.toml
- `mise install` — installs all tools defined in .mise.toml
- `just setup` — runs install + db::init + db::seed (Phase 13 recipe)

Keep all other settings unchanged:
- `customizations.vscode.extensions` — all still valid
- `customizations.vscode.settings` — keep as-is (python interpreter path may need updating if mise puts python elsewhere, but the venv path `backend/.venv/bin/python` is created by `just install-backend` which runs `uv venv` in backend/, so it should still be valid)
- `forwardPorts` — unchanged
- `portsAttributes` — unchanged
- `remoteUser` — unchanged
- `build` section — unchanged (Dockerfile still used for base image)

**Update `.devcontainer/post-create.sh`:**

The postCreateCommand now handles setup directly (`mise trust && mise install && just setup`), so post-create.sh is technically redundant. However, do NOT delete it yet (that's Phase 16). Instead, update it to use just in case it's invoked directly:

```bash
#!/bin/bash
set -e

echo "Setting up Maxwell's Wallet development environment..."

# Trust mise config and install all tools
mise trust
mise install

# Run project setup (install deps, init and seed database)
just setup

echo ""
echo "Development environment ready!"
echo ""
echo "Available commands:"
echo "  just dev::dev       - Start both frontend and backend"
echo "  just dev::backend   - Start backend only"
echo "  just dev::frontend  - Start frontend only"
echo "  just test::all      - Run all tests"
echo "  just --list         - Show all available commands"
echo ""
echo "Ports:"
echo "  http://localhost:3000  - Frontend (Next.js)"
echo "  http://localhost:3001  - Backend (FastAPI)"
```

Key changes to post-create.sh:
- Remove `make` references (replace with `just` commands)
- Remove manual `cd backend && uv run python -m scripts.init_db` (just setup handles it)
- Remove `make install` / `make db-seed` (just setup handles it)
- Add `mise trust && mise install` before `just setup`
- Update help text to show `just` commands instead of `make`
- Remove uv existence check (mise installs uv)
  </action>
  <verify>
    <automated>cd /Users/joe/Code/github.com/poindexter12/maxwells-wallet && grep -q "ghcr.io/jdx/mise/mise" .devcontainer/devcontainer.json && grep -q "mise trust" .devcontainer/devcontainer.json && grep -q "just setup" .devcontainer/post-create.sh && echo "PASS"</automated>
  </verify>
  <done>devcontainer.json uses mise feature for tool management with mise trust + mise install + just setup as postCreateCommand. post-create.sh updated to use just commands. No node/python devcontainer features remain.</done>
</task>

<task type="auto">
  <name>Task 2: Update devcontainer.yaml workflow to test mise + just</name>
  <files>.github/workflows/devcontainer.yaml</files>
  <action>
Update `.github/workflows/devcontainer.yaml` to validate mise and just are available in the built devcontainer.

In the "Start devcontainer and run tests" step, update the docker exec test commands:

Replace:
```bash
docker exec "$CONTAINER_ID" make --version || (echo "make not found" && exit 1)
```

With:
```bash
docker exec "$CONTAINER_ID" mise --version || (echo "mise not found" && exit 1)
docker exec "$CONTAINER_ID" just --version || (echo "just not found" && exit 1)
docker exec "$CONTAINER_ID" gum --version || (echo "gum not found" && exit 1)
```

Keep existing checks for node, python, uv, npm (these are still expected, just installed via mise now).

Update the Node.js version check — .mise.toml specifies the node version. Check what version is in .mise.toml (likely 22 based on current check). Keep the grep pattern matching.

The full test sequence should be:
1. `mise --version` — mise is installed
2. `node --version` — node available via mise (grep for expected version)
3. `python --version` — python available via mise (grep 3.11)
4. `uv --version` — uv available via mise (remove the `export PATH` workaround — mise manages PATH)
5. `just --version` — just available via mise
6. `gum --version` — gum available via mise
7. `npm --version` — npm available (comes with node)

Remove the make version check (make is no longer required in the devcontainer).

Also update the trigger paths to include `.mise.toml` since changes to tool versions should trigger devcontainer validation:
```yaml
on:
  push:
    branches: [main]
    paths:
      - '.devcontainer/**'
      - '.mise.toml'
  pull_request:
    branches: [main]
    paths:
      - '.devcontainer/**'
      - '.mise.toml'
```
  </action>
  <verify>
    <automated>cd /Users/joe/Code/github.com/poindexter12/maxwells-wallet && grep -q "just --version" .github/workflows/devcontainer.yaml && grep -q "mise --version" .github/workflows/devcontainer.yaml && grep -q "gum --version" .github/workflows/devcontainer.yaml && ! grep -q "make --version" .github/workflows/devcontainer.yaml && echo "PASS"</automated>
  </verify>
  <done>devcontainer.yaml workflow validates mise, just, gum, node, python, uv, and npm are available in built container. make version check removed. Trigger paths include .mise.toml.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep "ghcr.io/devcontainers/features/node" .devcontainer/devcontainer.json` returns no matches
2. `grep "ghcr.io/devcontainers/features/python" .devcontainer/devcontainer.json` returns no matches
3. `grep "ghcr.io/jdx/mise/mise" .devcontainer/devcontainer.json` returns a match
4. `grep "mise trust" .devcontainer/devcontainer.json` returns a match
5. `grep "just setup" .devcontainer/post-create.sh` returns a match
6. `grep "make" .devcontainer/post-create.sh` returns no matches
7. `grep "mise --version" .github/workflows/devcontainer.yaml` returns a match
8. `grep "just --version" .github/workflows/devcontainer.yaml` returns a match
</verification>

<success_criteria>
- devcontainer.json uses mise feature as sole tool manager (except github-cli)
- postCreateCommand chain: mise trust → mise install → just setup
- post-create.sh updated with just commands (kept for Phase 16 cleanup)
- devcontainer.yaml tests for mise, just, gum availability
- devcontainer.yaml trigger paths include .mise.toml
</success_criteria>

<output>
After completion, create `.planning/phases/14-integration/14-02-SUMMARY.md`
</output>
