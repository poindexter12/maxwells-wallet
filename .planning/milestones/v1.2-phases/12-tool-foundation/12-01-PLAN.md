---
phase: 12-tool-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .mise.toml
  - .envrc
  - .env
  - .gitignore
autonomous: true
requirements:
  - MISE-01
  - MISE-02
  - MISE-03
  - MISE-04

must_haves:
  truths:
    - "Running `just --version`, `gum --version`, `node --version`, `python --version`, `uv --version` all succeed after mise installs tools"
    - "Tool versions match .mise.toml specification without manual intervention"
    - "Secrets (CROWDIN_PERSONAL_TOKEN, ANTHROPIC_API_KEY) load from gitignored .env file, not from committed .envrc"
    - ".envrc contains only `use mise` directive, no hardcoded secrets"
  artifacts:
    - path: ".mise.toml"
      provides: "Declarative tool versions and environment config"
      contains: "[tools]"
    - path: ".env"
      provides: "Secrets storage (gitignored)"
      contains: "CROWDIN_PERSONAL_TOKEN"
    - path: ".envrc"
      provides: "Minimal direnv delegation to mise"
      contains: "use mise"
  key_links:
    - from: ".mise.toml"
      to: ".env"
      via: "[env] _.file directive"
      pattern: '_.file\s*=\s*".env"'
    - from: ".envrc"
      to: ".mise.toml"
      via: "use mise directive"
      pattern: "use mise"
---

<objective>
Create the mise tool foundation: `.mise.toml` for declarative tool and environment management, migrate secrets from `.envrc` to gitignored `.env`, and reduce `.envrc` to a minimal `use mise` delegation.

Purpose: Replace the fragmented tooling setup (nvm for Node, manual Python, direnv for env vars) with a single declarative config that auto-installs all dev tools and loads environment variables on `cd`.

Output: `.mise.toml`, `.env` (secrets), updated `.envrc` (minimal), updated `.gitignore`
</objective>

<execution_context>
@/Users/joe/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-tool-foundation/12-RESEARCH.md

<interfaces>
<!-- No code interfaces needed. This is pure configuration work. -->
<!-- Existing files to be aware of: -->

Current .envrc (to be replaced):
```bash
export CROWDIN_PERSONAL_TOKEN="REDACTED"
export ANTHROPIC_API_KEY="REDACTED"
```

Current .nvmrc (will be superseded by .mise.toml):
```
22
```

Current .gitignore already includes:
```
.env
.env.local
.env.production
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create .mise.toml and .env, update .envrc</name>
  <files>.mise.toml, .env, .envrc</files>
  <action>
Create `.mise.toml` with the following content:

```toml
# .mise.toml - Tool Foundation Configuration
# Replaces: .nvmrc, manual Python/uv setup, direnv env exports
# All dev tools managed declaratively - auto-installed on `cd`

[tools]
# Frontend tooling
node = "22"                    # Latest Node 22.x (matches .nvmrc)
# Backend tooling
python = "3.11"                # Python 3.11.x (matches project requirement)
uv = "latest"                  # Python package manager
# Build system (Phase 13+)
"cargo:just" = "latest"        # Command runner (replaces Make)
"cargo:gum" = "latest"         # Terminal UI toolkit

[env]
# Load secrets from gitignored .env file
_.file = ".env"
# Development defaults
NODE_ENV = "development"

[settings]
# Auto-install missing tools when entering directory
auto_install = true
# Parallel downloads for faster tool installation
jobs = 4
```

Create `.env` with the secrets currently in `.envrc`:

```
# Local secrets - DO NOT COMMIT (gitignored)
CROWDIN_PERSONAL_TOKEN=REDACTED
ANTHROPIC_API_KEY=REDACTED
```

Note: No `export` prefix, no quotes around values. This is dotenvy format that mise reads via `_.file`.

Replace `.envrc` contents with minimal delegation:

```bash
# All tool and environment management handled by mise
# See .mise.toml for tool versions and .env for secrets
use mise
```

Verify `.env` is already in `.gitignore` (it is -- confirmed during research). Do NOT commit `.env`.
  </action>
  <verify>
    <automated>test -f .mise.toml && grep -q '\[tools\]' .mise.toml && grep -q 'node = "22"' .mise.toml && grep -q 'python = "3.11"' .mise.toml && grep -q 'uv = "latest"' .mise.toml && grep -q '"cargo:just"' .mise.toml && grep -q '"cargo:gum"' .mise.toml && grep -q '_.file = ".env"' .mise.toml && grep -q 'auto_install = true' .mise.toml && echo "PASS: .mise.toml valid" || echo "FAIL: .mise.toml missing or incomplete"</automated>
    <automated>test -f .env && grep -q 'CROWDIN_PERSONAL_TOKEN=' .env && grep -q 'ANTHROPIC_API_KEY=' .env && echo "PASS: .env has secrets" || echo "FAIL: .env missing or incomplete"</automated>
    <automated>grep -q 'use mise' .envrc && ! grep -q 'export' .envrc && echo "PASS: .envrc is minimal" || echo "FAIL: .envrc still has exports"</automated>
    <automated>grep -q '^\.env$' .gitignore && echo "PASS: .env is gitignored" || echo "FAIL: .env not in .gitignore"</automated>
  </verify>
  <done>
    - .mise.toml exists with [tools] section listing node=22, python=3.11, uv=latest, cargo:just=latest, cargo:gum=latest
    - .mise.toml has [env] section with _.file=".env" and NODE_ENV=development
    - .mise.toml has [settings] with auto_install=true
    - .env exists with CROWDIN_PERSONAL_TOKEN and ANTHROPIC_API_KEY (no export prefix, no quotes)
    - .envrc contains only "use mise" (no hardcoded secrets)
    - .env is in .gitignore (not committed)
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate mise tool installation and environment loading</name>
  <files>.mise.toml</files>
  <action>
Run `mise trust` to trust the new `.mise.toml` configuration (required on first use).

Run `mise install` to install all tools defined in `.mise.toml`. This will install:
- node 22.x
- python 3.11.x
- uv (latest)
- just (latest, via cargo)
- gum (latest, via cargo)

After installation, verify each tool is accessible and at the correct version:
- `mise exec -- node --version` should output v22.x.x
- `mise exec -- python --version` should output Python 3.11.x
- `mise exec -- uv --version` should output a version
- `mise exec -- just --version` should output a version
- `mise exec -- gum --version` should output a version

Verify environment loading:
- `mise env` should show CROWDIN_PERSONAL_TOKEN and ANTHROPIC_API_KEY loaded from .env
- `mise env` should show NODE_ENV=development from .mise.toml [env] section

If any tool fails to install via `cargo:` prefix, try alternative install methods:
- `"npm:just"` or `just` (if mise has a core plugin)
- For gum: check `mise plugins ls-remote` for available backends

Fix any issues in `.mise.toml` until all five tools install and version commands succeed.
  </action>
  <verify>
    <automated>mise trust --yes 2>/dev/null; mise install 2>&1 && mise exec -- node --version && mise exec -- python --version && mise exec -- uv --version && mise exec -- just --version && mise exec -- gum --version && echo "PASS: all tools installed" || echo "FAIL: tool installation incomplete"</automated>
    <automated>mise env 2>/dev/null | grep -q 'CROWDIN_PERSONAL_TOKEN' && mise env 2>/dev/null | grep -q 'NODE_ENV=development' && echo "PASS: env loaded" || echo "FAIL: env not loading"</automated>
  </verify>
  <done>
    - `mise install` completes without errors
    - `mise exec -- node --version` outputs v22.x.x
    - `mise exec -- python --version` outputs Python 3.11.x
    - `mise exec -- uv --version` outputs a version string
    - `mise exec -- just --version` outputs a version string
    - `mise exec -- gum --version` outputs a version string
    - `mise env` includes CROWDIN_PERSONAL_TOKEN and ANTHROPIC_API_KEY from .env
    - `mise env` includes NODE_ENV=development from .mise.toml
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full Phase 12 success criteria:

1. **MISE-01**: `.mise.toml` [tools] section manages just, gum, node, python, uv
   - `grep -c '=' .mise.toml` shows all 5 tools defined
   - `mise ls` shows all tools with versions

2. **MISE-02**: mise auto-installs correct tool versions
   - `mise install` succeeds
   - All `mise exec -- <tool> --version` commands work
   - Versions match `.mise.toml` specification

3. **MISE-03**: Secrets load from gitignored .env via mise [env]
   - `.env` contains secrets (not committed)
   - `.mise.toml` has `_.file = ".env"` in [env] section
   - `mise env` shows secrets loaded

4. **MISE-04**: .envrc delegates to mise via `use mise`
   - `.envrc` contains `use mise` and nothing else
   - No `export` statements in `.envrc`
</verification>

<success_criteria>
- All five tools (just, gum, node, python, uv) install via mise and respond to `--version`
- Secrets load from .env (not from .envrc)
- .envrc is a one-liner (`use mise`)
- No secrets in committed files
- .mise.toml is the single source of truth for tool versions
</success_criteria>

<output>
After completion, create `.planning/phases/12-tool-foundation/12-01-SUMMARY.md`
</output>
