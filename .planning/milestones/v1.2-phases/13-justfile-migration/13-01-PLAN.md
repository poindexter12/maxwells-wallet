---
phase: 13-justfile-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/gum-helpers.sh
  - justfile
  - .just/dev.just
  - .just/db.just
  - .just/test.just
  - .just/docker.just
  - .just/release.just
  - .just/i18n.just
  - .just/utils.just
autonomous: true
requirements: [JUST-02, JUST-03, JUST-04, JUST-05, JUST-06, JUST-07, GUM-01, GUM-02, GUM-03, GUM-04, GUM-05]

must_haves:
  truths:
    - "Running `source scripts/gum-helpers.sh && type is_tty spin confirm style` succeeds — all 4 functions are defined"
    - "Running `just --list` succeeds and shows organized recipes from dev and db modules"
    - "Running `just --summary` parses all module files without errors"
    - "`just dev::backend` starts the backend server (identical to `make backend`)"
    - "`just dev::frontend` starts the frontend server (identical to `make frontend`)"
    - "`just db::init` initializes the database (identical to `make db-init`)"
    - "Stub modules (test, docker, release, i18n, utils) each have at least one placeholder recipe"
    - "No ANSI escape codes exist in justfile or .just/ files (all styled via gum-helpers.sh)"
  artifacts:
    - path: "scripts/gum-helpers.sh"
      provides: "TTY-aware gum wrapper functions (is_tty, spin, confirm, style)"
      contains: "is_tty"
    - path: "justfile"
      provides: "Root justfile with shell settings, shared variables, module imports, and core recipes"
      contains: "mod dev"
    - path: ".just/dev.just"
      provides: "Development recipes (backend, frontend, dev, build-frontend)"
      contains: "backend"
    - path: ".just/db.just"
      provides: "Database recipes (init, seed, reset, migrate, upgrade, demo-setup)"
      contains: "reset"
  key_links:
    - from: ".just/dev.just"
      to: "scripts/gum-helpers.sh"
      via: "source in shebang recipes"
      pattern: "source.*gum-helpers"
    - from: ".just/db.just"
      to: "scripts/gum-helpers.sh"
      via: "source in shebang recipes"
      pattern: "source.*gum-helpers"
    - from: "justfile"
      to: ".just/dev.just"
      via: "mod dev"
      pattern: "mod dev"
---

<objective>
Create the gum helper library, root justfile with all module imports, and fully implement the dev and db modules. Create stub files for the remaining 5 modules so `just` can parse all imports.

Purpose: Establishes the foundation that all subsequent module implementations depend on. Dev and DB are the most-used recipes and validate the full pattern (shebang recipes, gum helpers, TTY detection, confirmations, spinners).

Output: 9 files — gum-helpers.sh, root justfile, 2 fully implemented modules (dev, db), 5 stub modules (test, docker, release, i18n, utils).
</objective>

<execution_context>
@/Users/joe/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-justfile-migration/13-RESEARCH.md
@.planning/phases/12-tool-foundation/12-01-SUMMARY.md

Source files to port:
@Makefile
@make/dev.mk
@make/db.mk

<interfaces>
<!-- Phase 12 established mise tool management. Key file: -->

From .mise.toml:
```toml
[tools]
node = "22"
python = "3.11"
uv = "latest"
just = "latest"
gum = "latest"

[env]
_.file = ".env"
NODE_ENV = "development"
```

From Makefile (shared variables to port):
```make
BLUE := \033[0;34m
GREEN := \033[0;32m
YELLOW := \033[0;33m
RED := \033[0;31m
NC := \033[0m
BACKEND_DIR := backend
FRONTEND_DIR := frontend
```

From make/dev.mk (targets to port):
- backend: Run backend (migrations first, uvicorn reload)
- frontend: Run frontend (pseudo-locale support via ENABLE_PSEUDO)
- dev: Run both in parallel (make -j2)
- build-frontend: npm run build

From make/db.mk (targets to port):
- db-init: Initialize database (asyncio init_db)
- db-seed: Seed with sample data (python -m scripts.seed)
- db-reset: Delete and recreate (DESTRUCTIVE — needs gum confirm)
- db-migrate: Create migration (interactive prompt for message)
- db-upgrade: Apply migrations (alembic upgrade head)
- demo-setup: Set up demo mode (scripts.setup_demo)
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create gum-helpers.sh and root justfile with core recipes</name>
  <files>scripts/gum-helpers.sh, justfile</files>
  <action>
**1. Create `scripts/gum-helpers.sh`** (~50 LOC):

```bash
#!/usr/bin/env bash
# Shared gum helper functions for justfile recipes
# Source this file in shebang recipes: source scripts/gum-helpers.sh
```

Functions to implement:
- `is_tty()` — returns 0 if stdout is a terminal (`[ -t 1 ]`)
- `spin(title, ...cmd)` — if TTY, run `gum spin --spinner dot --title "$title" -- "$@"`. If not TTY, echo title and run command directly.
- `confirm(message, default)` — if TTY, run `gum confirm "$message" --default="$default"`. If not TTY, return based on default value (true=0, false=1).
- `style(color, ...text)` — if TTY, run `gum style --foreground "$color" "$@"`. If not TTY, echo text plain.
- `header(text)` — if TTY, run `gum style --border double --border-foreground 212 --padding "0 2" "$text"`. If not TTY, echo text.

Make the file executable (`chmod +x`).

**2. Create root `justfile`** (~60 LOC):

Top-level settings:
```just
# Maxwell's Wallet - Task Runner
# Run `just --list` to see all available recipes

set shell := ['bash', '-euo', 'pipefail', '-c']
set dotenv-load := false  # mise handles .env loading

# Shared variables
BACKEND_DIR := "backend"
FRONTEND_DIR := "frontend"
```

Module imports (all 7 — module files will be created in this plan):
```just
mod dev '.just/dev.just'
mod db '.just/db.just'
mod test '.just/test.just'
mod docker '.just/docker.just'
mod release '.just/release.just'
mod i18n '.just/i18n.just'
mod utils '.just/utils.just'
```

Core recipes (from Makefile root, not modules):
- `setup` — first-time setup (depends on `install`, `db init`, `db seed`). Use shebang recipe with gum styling for banner and completion message.
- `install` — install all deps (depends on `install-backend` and `install-frontend`)
- `install-backend` — port from Makefile `install-backend` target. Use `spin` for uv venv and uv sync.
- `install-frontend` — port from Makefile `install-frontend` target. Use `spin` for npm install.

For `setup`, call module recipes explicitly: `just db::init` and `just db::seed`.

Do NOT create a `help` recipe — `just --list` replaces it natively.

Every recipe MUST have a doc comment (line starting with `#` immediately above the recipe name) for `just --list` visibility. Use shebang recipes (`#!/usr/bin/env bash`) for any recipe with multi-line logic. Always `source scripts/gum-helpers.sh` at the top of shebang recipes. Always `set -euo pipefail` after the shebang.
  </action>
  <verify>
    <automated>cd /Users/joe/Code/github.com/poindexter12/maxwells-wallet && bash -c 'source scripts/gum-helpers.sh && type is_tty && type spin && type confirm && type style' && just --list 2>&1 | head -20 && grep -c "gum" scripts/gum-helpers.sh</automated>
  </verify>
  <done>
    - scripts/gum-helpers.sh exists with is_tty, spin, confirm, style, header functions
    - gum-helpers.sh is executable
    - Root justfile has shell set to bash with strict mode
    - Root justfile imports all 7 modules
    - Core recipes (setup, install, install-backend, install-frontend) defined with doc comments
    - `just --list` succeeds without parse errors
    - Zero ANSI escape codes in justfile (all styling via gum-helpers.sh)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dev.just and db.just modules plus stub files for remaining modules</name>
  <files>.just/dev.just, .just/db.just, .just/test.just, .just/docker.just, .just/release.just, .just/i18n.just, .just/utils.just</files>
  <action>
Create the `.just/` directory if it does not exist.

**1. Create `.just/dev.just`** — port from `make/dev.mk` (30 lines → ~50 lines):

Recipes to port:
- `backend` — Run backend server. Shebang recipe: run alembic upgrade head first, then uvicorn with reload. Use `style 12 "Running database migrations..."` and `style 2 "Starting backend server..."`. The `cd backend` happens inside the shebang recipe body. Port exactly: `cd backend && uv run alembic upgrade head`, then `cd backend && . .venv/bin/activate && uv run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000`.
- `frontend` — Run frontend server. Shebang recipe: if `ENABLE_PSEUDO` env var is "true", regenerate pseudo-locale first (`cd frontend && node scripts/generate-pseudo-locale.mjs`). Then `cd frontend && npm run dev`. Use `style 12` for status messages.
- `dev` — Run both backend and frontend in parallel. Use `just dev::backend & just dev::frontend & wait` pattern in a shebang recipe. This satisfies JUST-06 (parallel dev server startup). Print startup message with `style 12`.
- `build-frontend` — Build frontend for production. Shebang recipe: `cd frontend && npm run build` wrapped in `spin "Building frontend..." npm run build`. Use `style 2 "Frontend built"` on success.

Every recipe must have a `#` doc comment for `just --list`.

**2. Create `.just/db.just`** — port from `make/db.mk` (50 lines → ~80 lines):

Recipes to port:
- `init` — Initialize database. Shebang recipe porting the Python asyncio init_db call. Use `spin` wrapper.
- `seed` — Seed database. Shebang recipe porting `python -m scripts.seed`. Use `spin` wrapper.
- `reset` — Reset database. DESTRUCTIVE: use `confirm "Reset database? This will delete all data." false`. If confirmed, `rm -f backend/wallet.db`, then call `just db::init` and `just db::seed`. Use `style 1` for warning, `style 2` for success. This satisfies GUM-03.
- `migrate MESSAGE=""` — Create migration. Parameter with default empty string. If MESSAGE is empty AND is_tty, prompt with `gum input --placeholder "Migration message"`. If MESSAGE is empty AND not TTY, error out. Then run alembic revision. This satisfies JUST-05 (parameters with defaults).
- `upgrade` — Apply migrations. Shebang recipe with `spin` wrapper around `uv run alembic upgrade head`.
- `demo-setup` — Set up demo mode. Shebang recipe porting `python -m scripts.setup_demo`. Style output.

**3. Create stub files for remaining 5 modules** — minimal content so `just` can parse them:

For each of `.just/test.just`, `.just/docker.just`, `.just/release.just`, `.just/i18n.just`, `.just/utils.just`:

```just
# [Module Name] recipes
# Full implementation in Phase 13, Plan 02

# Placeholder (will be replaced with full recipes)
placeholder:
    @echo "Module not yet implemented — see Phase 13 Plan 02"
```

Each stub MUST have at least one recipe (just requires at least one recipe per module file for parsing).

**Important implementation notes:**
- Use `#!/usr/bin/env bash` shebang + `set -euo pipefail` + `source scripts/gum-helpers.sh` at the top of every multi-line recipe
- Replace ALL ANSI escape codes with gum style calls (GUM-02). No `\033[` anywhere.
- Use `spin` for operations that take >2 seconds (GUM-04): uv sync, npm install, alembic operations, npm run build
- Use `confirm` for destructive operations (GUM-03): db reset
- Every recipe has a doc comment (JUST-03)
- Recipe dependencies use just syntax: `recipe: dep1 dep2` (JUST-04)
- In shebang recipes, access justfile variables via `{{ BACKEND_DIR }}` syntax — but since these are shebang recipes with hardcoded paths ("backend", "frontend"), use string literals directly matching the Make source
  </action>
  <verify>
    <automated>cd /Users/joe/Code/github.com/poindexter12/maxwells-wallet && just --list 2>&1 && echo "---" && just --list 2>&1 | grep -c "::" && echo "module recipes found" && grep -rL "\\\\033\[" .just/ justfile || echo "No ANSI codes found (good)" && test -f .just/dev.just && test -f .just/db.just && test -f .just/test.just && test -f .just/docker.just && test -f .just/release.just && test -f .just/i18n.just && test -f .just/utils.just && echo "All 7 module files exist"</automated>
  </verify>
  <done>
    - .just/ directory exists with 7 module files
    - dev.just has 4 recipes (backend, frontend, dev, build-frontend) with doc comments
    - db.just has 6 recipes (init, seed, reset, migrate, upgrade, demo-setup) with doc comments
    - db reset recipe uses gum confirm for destructive action confirmation
    - db migrate recipe accepts MESSAGE parameter with gum input fallback
    - dev recipe runs backend and frontend in parallel
    - 5 stub module files parse without errors
    - `just --list` shows all dev and db recipes with descriptions
    - Zero ANSI escape codes in any .just file
    - All shebang recipes source gum-helpers.sh
  </done>
</task>

</tasks>

<verification>
1. `just --list` succeeds and shows organized recipe list with dev:: and db:: namespaced recipes
2. `bash -c 'source scripts/gum-helpers.sh && type is_tty && type spin && type confirm && type style'` — all helpers defined
3. `grep -r "\\\\033\[" .just/ justfile` returns no matches (no raw ANSI codes)
4. `just --show dev::backend` shows the backend recipe content
5. `just --show db::reset` shows gum confirm usage
6. `just --show db::migrate` shows MESSAGE parameter
7. All 7 module files exist in .just/
8. Root justfile has `set shell := ['bash', '-euo', 'pipefail', '-c']`
</verification>

<success_criteria>
- gum-helpers.sh provides TTY-aware wrappers for all gum operations
- Root justfile is the entry point with bash strict mode and all 7 module imports
- Dev module mirrors make/dev.mk with identical behavior
- DB module mirrors make/db.mk with identical behavior plus gum enhancements (confirm, input, spin)
- Stub modules allow `just` to parse without errors
- Running `just --list` shows a clean, organized recipe catalog
</success_criteria>

<output>
After completion, create `.planning/phases/13-justfile-migration/13-01-SUMMARY.md`
</output>
