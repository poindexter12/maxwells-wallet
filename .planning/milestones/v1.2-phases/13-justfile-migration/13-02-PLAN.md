---
phase: 13-justfile-migration
plan: 02
type: execute
wave: 2
depends_on: [13-01]
files_modified:
  - .just/test.just
  - .just/docker.just
  - .just/release.just
  - .just/i18n.just
  - .just/utils.just
autonomous: true
requirements: [JUST-01, JUST-02, JUST-03, JUST-04, JUST-05, GUM-02, GUM-03, GUM-04, GUM-05]

must_haves:
  truths:
    - "`just --list` shows all recipes from all 7 modules with doc comments"
    - "Every documented Make target from make/*.mk has a corresponding just recipe"
    - "Destructive recipes (docker::clean, utils::clean-all) require gum confirmation"
    - "Long-running recipes (test::backend, docker::build, release::release) show gum spinners"
    - "Non-TTY environments get plain text output (no gum calls, no ANSI codes)"
    - "`just release::release VERSION=x.y.z` accepts VERSION parameter"
    - "Recipe dependencies work (e.g., `just utils::clean-all` depends on `just utils::clean`)"
  artifacts:
    - path: ".just/test.just"
      provides: "Testing and quality recipes (test-backend, test-e2e, lint, quality, etc.)"
      contains: "backend"
    - path: ".just/docker.just"
      provides: "Docker recipes (build, up, down, clean, shell, logs, etc.)"
      contains: "build"
    - path: ".just/release.just"
      provides: "Release recipes (release, release-patch, release-check, etc.)"
      contains: "release-check"
    - path: ".just/i18n.just"
      provides: "Translation recipes (upload, download, status, pseudo, harvest)"
      contains: "upload"
    - path: ".just/utils.just"
      provides: "Utility recipes (clean, clean-all, status, info, check-deps, data-*)"
      contains: "clean-all"
  key_links:
    - from: ".just/test.just"
      to: "scripts/gum-helpers.sh"
      via: "source in shebang recipes"
      pattern: "source.*gum-helpers"
    - from: ".just/docker.just"
      to: "scripts/gum-helpers.sh"
      via: "source in shebang recipes"
      pattern: "source.*gum-helpers"
    - from: ".just/release.just"
      to: "scripts/gum-helpers.sh"
      via: "source in shebang recipes"
      pattern: "source.*gum-helpers"
---

<objective>
Replace the 5 stub module files with full implementations, porting all remaining Make targets to just recipes with gum UX enhancements.

Purpose: Completes the justfile migration by implementing test, docker, release, i18n, and utils modules — covering all 83 Make targets. After this plan, every `make <target>` has a `just <module>::<recipe>` equivalent.

Output: 5 fully implemented module files replacing the stubs from Plan 01.
</objective>

<execution_context>
@/Users/joe/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-justfile-migration/13-RESEARCH.md
@.planning/phases/13-justfile-migration/13-01-SUMMARY.md

Source files to port:
@make/test.mk
@make/docker.mk
@make/release.mk
@make/i18n.mk
@make/utils.mk

Pattern reference (created in Plan 01):
@scripts/gum-helpers.sh
@justfile
@.just/dev.just
@.just/db.just

<interfaces>
<!-- gum-helpers.sh functions available (created in Plan 01): -->
```bash
is_tty()     # Returns 0 if stdout is a terminal
spin(title, ...cmd)  # Gum spinner if TTY, plain if not
confirm(message, default)  # Gum confirm if TTY, default-based if not
style(color, ...text)  # Gum styled text if TTY, plain if not
header(text)  # Bordered header if TTY, plain if not
```

<!-- Color codes for gum style --foreground: -->
# Blue: 12  |  Green: 2  |  Yellow: 11  |  Red: 1

<!-- Shebang recipe pattern (established in Plan 01): -->
```just
# Doc comment for just --list
recipe-name PARAM="default":
    #!/usr/bin/env bash
    set -euo pipefail
    source scripts/gum-helpers.sh

    style 12 "Doing something..."
    cd backend && uv run some-command
    style 2 "Done"
```

<!-- From make/test.mk (191 lines, targets to port): -->
# Unit/Integration: test-backend, test-unit (alias), test-coverage, test-reports, test-tags, test-import, test-budgets
# E2E: test-e2e-install, test-e2e, test-e2e-headed, test-e2e-debug, test-e2e-import, test-e2e-full
# Chaos: test-chaos, test-chaos-headed
# Perf: test-perf, test-perf-quick, test-perf-verbose
# Lint: lint-frontend, lint-backend, lint (both)
# Quality: vulture, dead-code (alias), typecheck, quality (all), security-audit
# Aggregate: test-all (test-backend + test-e2e)

<!-- From make/docker.mk (91 lines, targets to port): -->
# COMPOSE_DEV := docker compose -f docker-compose.dev.yaml
# COMPOSE_DEMO := docker compose -f docker-compose.demo.yaml
# docker, docker-with-pseudo, docker-with-demo
# docker-build, docker-build-force, docker-build-pseudo
# docker-up, docker-down, docker-logs, docker-shell
# docker-clean (DESTRUCTIVE), docker-seed, docker-migrate
# docker-demo-up, docker-demo-seed

<!-- From make/release.mk (145 lines, targets to port): -->
# Variables: CURRENT_VERSION (from pyproject.toml), FRONTEND_VERSION (from package.json), LAST_TAG
# release-check (dry-run validation), release-validate (fail on issues)
# release VERSION=x.y.z (full release with pre-flight, git tag, push)
# release-patch, release-minor, release-major (version bumps)

<!-- From make/i18n.mk (88 lines, targets to port): -->
# CROWDIN := cd frontend && npx crowdin, CROWDIN_CONFIG := -c ../crowdin.yaml
# CROWDIN_PROJECT_ID := 854226
# translate-upload, translate-download, translate-status, translate-pseudo, translate-test
# translate-harvest, translate-harvest-new, translate-harvest-preview, translate-describe

<!-- From make/utils.mk (112 lines, targets to port): -->
# clean, clean-all (DESTRUCTIVE — depends on clean)
# status, info, check-deps, check-node
# data-setup, data-status, data-anonymize, data-force, data-clean
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement test.just and docker.just modules</name>
  <files>.just/test.just, .just/docker.just</files>
  <action>
Replace the stub files with full implementations.

**1. Replace `.just/test.just`** — port from `make/test.mk` (191 lines → ~200 lines):

Organize recipes in these sections (use `#` comments as section dividers):

**Unit/Integration Tests:**
- `backend` — Run backend tests. Shebang recipe: `cd backend && unset VIRTUAL_ENV && .venv/bin/python -m pytest --ignore=tests/e2e --ignore=tests/performance -v`. Use `spin` for the pytest run. Style start/end messages.
- `unit` — Alias. Just call `just test::backend`.
- `coverage` — Run with coverage. Same as backend but adds `--cov=app --cov-report=term-missing --cov-report=html`. Use `spin` with `--show-output` behavior (run directly, not wrapped in spin, since output matters).
- `reports` — Run report tests only. Specific test files: `tests/test_reports.py tests/test_new_analytics.py`.
- `tags` — Run tag tests only: `tests/test_tags.py tests/test_tag_rules.py`.
- `import` — Run import tests only: `tests/test_csv_import.py`.
- `budgets` — Run budget tests only: `tests/test_budgets.py`.

**E2E Tests (Playwright):**
- `e2e-install` — Install Playwright browsers. Use `spin` for the pip install and playwright install steps.
- `e2e` — Run E2E tests. Shebang recipe: check servers running first (curl localhost:8000 and localhost:3000), then run pytest tests/e2e. Style server check messages.
- `e2e-headed` — Same but add `--headed` flag.
- `e2e-debug` — Same but add `PWDEBUG=1` env var and `--headed -s` flags.
- `e2e-import` — Run only import workflow E2E: `tests/e2e/test_import_workflow.py`.
- `e2e-full` — Run full workflow E2E: `tests/e2e/test_full_workflow.py`.

**Chaos Tests:**
- `chaos` — Run chaos tests. Check servers (port 3001 for backend, 3000 for frontend), then `cd frontend && SKIP_MIGRATIONS=1 npx playwright test chaos/ --reporter=line`.
- `chaos-headed` — Same but add `--headed`.

**Performance Tests:**
- `perf` — Run performance tests: `-m performance`.
- `perf-quick` — Quick perf: `-m "performance and not slow"`.
- `perf-verbose` — Verbose perf: `-m performance --tb=long -s`.

**Linting:**
- `lint-frontend` — `cd frontend && npm run lint`.
- `lint-backend` — `cd backend && uv run ruff check .`.
- `lint` — Run both: depends on `lint-backend lint-frontend` (use recipe dependency syntax).

**Quality:**
- `vulture` — `cd backend && uv run vulture app/ --min-confidence 80`.
- `dead-code` — Alias for vulture.
- `typecheck` — `cd backend && uv run mypy app --ignore-missing-imports`.
- `quality` — Depends on `lint-backend vulture typecheck`.
- `security-audit` — `cd backend && uv run pip-audit`.

**Aggregate:**
- `all` — Depends on `backend e2e` (matching `test-all: test-backend test-e2e`).

IMPORTANT: For test recipes where output is important (pytest output, lint output), do NOT wrap in `gum spin` — the user needs to see the output. Use `style` for start/end messages but let the command output stream directly. Only use `spin` for setup operations (e2e-install) where the output is not critical.

**2. Replace `.just/docker.just`** — port from `make/docker.mk` (91 lines → ~120 lines):

Variables at top of module:
```just
# Docker compose commands
COMPOSE_DEV := "docker compose -f docker-compose.dev.yaml"
COMPOSE_DEMO := "docker compose -f docker-compose.demo.yaml"
```

Note: just module variables are local to the module. Use `{{ COMPOSE_DEV }}` in recipe bodies.

Recipes to port:
- `docker` — Depends on `build up`. (Name the recipe `docker` to match the Make target.) Actually, in just modules the recipe name should NOT match the module name. Name it `all` instead, with doc comment "Build and start Docker container (dev)".
- `with-pseudo` — Depends on `build-pseudo up`.
- `with-demo` — Shebang: build then `DEMO_MODE=true` docker compose up.
- `build` — `docker compose -f docker-compose.dev.yaml build`. Use `spin`.
- `build-force` — Same with `--no-cache`. Use `spin`.
- `build-pseudo` — `ENABLE_PSEUDO=true` build with `--no-cache`. Use `spin`.
- `up` — `docker compose up -d`. Print URL info after.
- `down` — `docker compose down`.
- `logs` — `docker compose logs -f`.
- `shell` — `docker compose exec maxwells-wallet /bin/bash`.
- `clean` — DESTRUCTIVE: use `confirm`. `docker compose down -v`.
- `seed` — `docker compose run --rm maxwells-wallet seed`.
- `migrate` — `docker compose run --rm maxwells-wallet migrate`.
- `demo-up` — Uses COMPOSE_DEMO. `docker compose -f docker-compose.demo.yaml up -d`.
- `demo-seed` — Uses COMPOSE_DEMO. `docker compose -f docker-compose.demo.yaml run --rm maxwells-wallet demo-setup`.

For docker recipes: use `spin` only for `build`, `build-force`, `build-pseudo` (long operations). All other docker commands (up, down, logs, shell) should run directly since they're fast or interactive.

Every recipe MUST have a doc comment. Use shebang recipes for any recipe with multi-line logic or gum usage. Replace ALL ANSI escape codes with `style` calls.
  </action>
  <verify>
    <automated>cd /Users/joe/Code/github.com/poindexter12/maxwells-wallet && just --list 2>&1 | grep "test::" | head -10 && echo "---" && just --list 2>&1 | grep "docker::" | head -10 && echo "---" && just --show test::backend 2>&1 | head -5 && just --show docker::clean 2>&1 | grep -i "confirm" && echo "Confirm found in docker clean"</automated>
  </verify>
  <done>
    - test.just has all 25+ recipes matching make/test.mk targets
    - docker.just has all 15 recipes matching make/docker.mk targets
    - docker::clean uses gum confirm for destructive action
    - Test recipes stream output directly (not wrapped in spinners)
    - Docker build recipes use spinners
    - Every recipe has a doc comment
    - `just --list` shows all test:: and docker:: recipes
    - Zero ANSI escape codes
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement release.just, i18n.just, and utils.just modules</name>
  <files>.just/release.just, .just/i18n.just, .just/utils.just</files>
  <action>
Replace the stub files with full implementations.

**1. Replace `.just/release.just`** — port from `make/release.mk` (145 lines → ~160 lines):

Variables at top (use backtick expressions for shell evaluation):
```just
# Version detection
CURRENT_VERSION := `grep -E '^version = ' backend/pyproject.toml | sed 's/version = "\(.*\)"/\1/'`
FRONTEND_VERSION := `grep -E '"version":' frontend/package.json | head -1 | sed 's/.*"version": "\(.*\)".*/\1/'`
LAST_TAG := `git describe --tags --abbrev=0 2>/dev/null || echo ""`
RELEASE_DOCS := "CHANGELOG.md README.md docs-site/index.md"
```

Recipes to port:
- `check` — Pre-flight validation (dry-run). Large shebang recipe that:
  - Prints version comparison (backend vs frontend) using `style`
  - Checks CHANGELOG.md for version section
  - Checks docs changed since last tag
  - Uses `style 2` for pass, `style 1` for fail (replacing ANSI codes)
  - Port the full logic from `release-check` Make target
- `validate` — Same checks but exits non-zero on failure. Port from `release-validate`.
- `release VERSION=""` — Full release flow. Parameter VERSION with empty default. Shebang recipe:
  - If VERSION empty, print usage info with available commands and current version using `style`
  - If VERSION provided, run pre-flight validation, update pyproject.toml and package.json versions, git commit, tag, push
  - Use `confirm "Create and push release v$VERSION?" false` before the destructive git operations
  - Port the full logic from Make `release` target
  - This satisfies JUST-05 (parameters with defaults) and GUM-03 (confirmation for release)
- `release-patch` — Calculate next patch version (x.y.Z+1), call `just release::release VERSION=$NEW_VERSION`.
- `release-minor` — Calculate next minor version (x.Y+1.0), call `just release::release`.
- `release-major` — Calculate next major version (X+1.0.0), call `just release::release`.

**2. Replace `.just/i18n.just`** — port from `make/i18n.mk` (88 lines → ~100 lines):

Variables at top:
```just
CROWDIN_CONFIG := "-c ../crowdin.yaml"
CROWDIN_PROJECT_ID := "854226"
```

Recipes to port:
- `upload` — Upload source strings. `cd frontend && npx crowdin upload sources -c ../crowdin.yaml`. Use `spin`.
- `download` — Download translations. `cd frontend && npx crowdin download -c ../crowdin.yaml`. Use `spin`.
- `status` — Show project status. `cd frontend && npx crowdin status -c ../crowdin.yaml`. Run directly (output matters).
- `pseudo` — Generate pseudo-locale. `cd frontend && node scripts/generate-pseudo-locale.mjs`.
- `test` — Run translation tests. `cd frontend && npm run test:run -- src/test/i18n.test.ts`.
- `harvest` — Full harvest. Shebang recipe porting the crowdin-context-harvester command with all flags. Use `style 11` warning about API costs.
- `harvest-new` — Harvest last 7 days. Same pattern with `--since="7 days ago"`.
- `harvest-preview` — Preview harvest (CSV, no upload). Same pattern with `--output=csv`.
- `describe` — Generate project description. Port the `translate-describe` target.

Note: `CROWDIN_PERSONAL_TOKEN` and `ANTHROPIC_API_KEY` are loaded by mise from `.env`. Reference them as `$CROWDIN_PERSONAL_TOKEN` in shebang recipes (env vars available in shell).

**3. Replace `.just/utils.just`** — port from `make/utils.mk` (112 lines → ~130 lines):

Recipes to port:

**Cleaning:**
- `clean` — Clean build artifacts. Shebang recipe removing __pycache__, .pytest_cache, .next, etc. Same paths as Make target.
- `clean-all` — DESTRUCTIVE: depends on `clean`. Uses `confirm "Remove all dependencies and database?" false`. Removes .venv, node_modules, wallet.db.

**Status/Info:**
- `status` — Check service status. Shebang recipe using curl to check backend (localhost:8000) and frontend (localhost:3000). Use `style 2` for running, `style 1` for not running.
- `info` — Show project info. Shebang recipe printing project details. Use `header` for title, `style` for colored sections. Port the info text from Make target.

**Dependency checking:**
- `check-deps` — Check required dependencies installed. Check for python3, uv, node, npm. Use `style 2` for found, `style 1` for missing.
- `check-node` — Check Node.js version matches .nvmrc. Port the nvm install logic from Make target.

**Data anonymization (delegates to data/Makefile):**
- `data-setup` — `make -C data setup` (keep delegating to data/Makefile since that's a separate concern).
- `data-status` — `make -C data status`.
- `data-anonymize` — `make -C data anonymize`.
- `data-force` — `make -C data force`.
- `data-clean` — `make -C data clean`.

NOTE for data-* recipes: These delegate to `data/Makefile` which is a separate sub-project. Use `make -C data <target>` in the recipe body (it's fine to call make from just for sub-project delegation).

Every recipe MUST have a doc comment. Replace ALL ANSI escape codes with `style` calls. Use `confirm` for destructive operations (clean-all). Use `spin` where appropriate (clean operations are fast, skip spinners).
  </action>
  <verify>
    <automated>cd /Users/joe/Code/github.com/poindexter12/maxwells-wallet && just --list 2>&1 | grep -E "(release|i18n|utils)::" | head -20 && echo "---" && just --show utils::clean-all 2>&1 | grep -i "confirm" && echo "Confirm found in clean-all" && just --show release::release 2>&1 | head -5 && echo "---" && grep -r "\\\\033\[" .just/ justfile; echo "ANSI check exit: $? (1=none found=good)"</automated>
  </verify>
  <done>
    - release.just has 6 recipes matching make/release.mk targets with VERSION parameter support
    - i18n.just has 8 recipes matching make/i18n.mk targets
    - utils.just has 11 recipes matching make/utils.mk targets
    - release::release uses confirm before git tag/push
    - utils::clean-all uses confirm before destructive clean
    - Every recipe has a doc comment
    - `just --list` shows all release::, i18n::, and utils:: recipes
    - Zero ANSI escape codes in any .just file
    - All 83+ Make targets now have just recipe equivalents (JUST-01 complete)
  </done>
</task>

</tasks>

<verification>
1. `just --list` shows all recipes from all 7 modules with descriptions
2. Count total recipes: `just --list --unsorted 2>&1 | grep "::" | wc -l` should be >= 70
3. `grep -r "\\\\033\[" .just/ justfile` returns no matches (GUM-02 complete)
4. `grep -r "gum confirm" .just/` shows confirmations in db.just, docker.just, utils.just, release.just (GUM-03)
5. `grep -r "gum spin\|spin " .just/` shows spinners in appropriate recipes (GUM-04)
6. `grep -r "is_tty" scripts/gum-helpers.sh` confirms TTY detection (GUM-05)
7. `just --show release::release` shows VERSION parameter (JUST-05)
8. `head -3 justfile` shows bash shell setting (JUST-07)
9. All 7 module files exist in .just/ (JUST-02)
</verification>

<success_criteria>
- All 83+ Make targets have just recipe equivalents with identical behavior (JUST-01)
- All 7 domain modules are fully implemented (JUST-02)
- Every recipe has a doc comment visible in `just --list` (JUST-03)
- Recipe dependencies preserved (JUST-04)
- Parameters with defaults work for release VERSION, db migrate MESSAGE (JUST-05)
- Destructive operations (db reset, docker clean, clean-all, release) require gum confirmation (GUM-03)
- Long operations use gum spinners (GUM-04)
- Non-TTY environments get plain text fallback (GUM-05)
- Zero raw ANSI escape codes in justfile or .just/ (GUM-02)
</success_criteria>

<output>
After completion, create `.planning/phases/13-justfile-migration/13-02-SUMMARY.md`
</output>
