---
phase: 08-dashboard-polish-error-handling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/app/(main)/transactions/page.tsx
  - frontend/src/components/transactions/TransactionFilters.tsx
  - frontend/src/components/transactions/BulkActions.tsx
  - frontend/src/components/transactions/useTransactionData.ts
  - frontend/src/components/transactions/index.ts
autonomous: true
requirements: [DASH-04]

must_haves:
  truths:
    - "Transactions page.tsx is under 500 lines"
    - "Filter UI (search, buckets, accounts, dates) extracted to dedicated component"
    - "Bulk actions UI (select all, tag, delete) extracted to dedicated component"
    - "Data fetching logic extracted to custom hook"
  artifacts:
    - path: "frontend/src/app/(main)/transactions/page.tsx"
      provides: "Main transactions page coordinator"
      max_lines: 500
    - path: "frontend/src/components/transactions/TransactionFilters.tsx"
      provides: "Filter UI with search, bucket, account, date controls"
      min_lines: 200
    - path: "frontend/src/components/transactions/BulkActions.tsx"
      provides: "Bulk selection and action controls"
      min_lines: 100
    - path: "frontend/src/components/transactions/useTransactionData.ts"
      provides: "Hook for transaction fetching with pagination"
      min_lines: 150
  key_links:
    - from: "frontend/src/app/(main)/transactions/page.tsx"
      to: "useTransactionData hook"
      via: "destructure data and methods"
      pattern: "useTransactionData\\("
    - from: "frontend/src/components/transactions/TransactionFilters.tsx"
      to: "filter state"
      via: "receives filters + setFilters props"
      pattern: "filters.*setFilters"
    - from: "frontend/src/components/transactions/BulkActions.tsx"
      to: "selected transactions"
      via: "receives selectedIds + setSelectedIds props"
      pattern: "selectedIds.*setSelectedIds"
---

<objective>
Extract transactions page to under 500 lines by moving filter UI, bulk actions, and data fetching to reusable components

Purpose: Reduce complexity of 1323-line monolithic page for easier maintenance and testing
Output: Extracted TransactionFilters component, BulkActions component, useTransactionData hook, main page under 500 lines
</objective>

<execution_context>
@/Users/joe/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONCERNS.md
@.planning/codebase/CONVENTIONS.md

# Phase 7 pattern - widget extraction with typed hooks
@.planning/phases/07-type-safety-dashboard-extraction/07-01-SUMMARY.md

# Current transactions page (1323 lines)
@frontend/src/app/(main)/transactions/page.tsx

# Existing transaction components
@frontend/src/components/transactions/VirtualTransactionList.tsx
@frontend/src/components/transactions/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract filter UI to TransactionFilters component</name>
  <files>
    frontend/src/components/transactions/TransactionFilters.tsx
    frontend/src/components/transactions/index.ts
    frontend/src/app/(main)/transactions/page.tsx
  </files>
  <action>
Create frontend/src/components/transactions/TransactionFilters.tsx:
- Extract all filter UI controls from TransactionsContent component
- Props interface:
  ```typescript
  interface TransactionFiltersProps {
    filters: FilterState
    setFilters: (filters: FilterState) => void
    searchInput: string
    setSearchInput: (value: string) => void
    showAdvancedFilters: boolean
    setShowAdvancedFilters: (show: boolean) => void
    showAccountDropdown: boolean
    setShowAccountDropdown: (show: boolean) => void
    bucketTags: Tag[]
    accountTags: Tag[]
    occasionTags: Tag[]
    totalCount: number
  }
  ```
- Include: search input, bucket dropdown, occasion dropdown, account multi-select, date pickers, amount range, status filter, transfer filter, advanced filters toggle
- Keep all existing TEST_IDS for E2E test compatibility
- Use existing translation keys (transactions namespace)
- Apply existing Tailwind styling patterns
- Extract filter state type definition (FilterState interface)

Update frontend/src/components/transactions/index.ts:
- Add export for TransactionFilters

Update frontend/src/app/(main)/transactions/page.tsx:
- Replace inline filter UI with TransactionFilters component
- Pass filter state and handlers as props
- Remove extracted JSX (approximately 300-400 lines reduction)
  </action>
  <verify>
```bash
cd frontend
test -f src/components/transactions/TransactionFilters.tsx && echo "TransactionFilters component exists"
wc -l src/components/transactions/TransactionFilters.tsx  # Should be ~200-300 lines
make lint  # Should pass
make build-frontend  # Should compile
```
  </verify>
  <done>
- TransactionFilters component exists with all filter controls
- Component properly typed with TypeScript interface
- Main page imports and uses TransactionFilters
- All existing TEST_IDS preserved
- Build and lint pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Extract bulk actions to BulkActions component</name>
  <files>
    frontend/src/components/transactions/BulkActions.tsx
    frontend/src/components/transactions/index.ts
    frontend/src/app/(main)/transactions/page.tsx
  </files>
  <action>
Create frontend/src/components/transactions/BulkActions.tsx:
- Extract bulk selection and action controls from TransactionsContent
- Props interface:
  ```typescript
  interface BulkActionsProps {
    selectedIds: Set<number>
    setSelectedIds: (ids: Set<number>) => void
    transactions: Transaction[]
    onBulkTag: (tagNamespace: string, tagValue: string) => Promise<void>
    onBulkDelete: () => Promise<void>
    bucketTags: Tag[]
    occasionTags: Tag[]
  }
  ```
- Include: select all checkbox, selected count display, bulk tag dropdown, bulk delete button, clear selection
- Keep all existing TEST_IDS for E2E test compatibility
- Use existing translation keys (transactions namespace)
- Handle loading states during bulk operations
- Apply existing Tailwind styling patterns

Update frontend/src/components/transactions/index.ts:
- Add export for BulkActions

Update frontend/src/app/(main)/transactions/page.tsx:
- Replace inline bulk action UI with BulkActions component
- Pass selection state and action handlers as props
- Remove extracted JSX (approximately 100-150 lines reduction)
  </action>
  <verify>
```bash
cd frontend
test -f src/components/transactions/BulkActions.tsx && echo "BulkActions component exists"
wc -l src/components/transactions/BulkActions.tsx  # Should be ~100-150 lines
grep -q "BulkActions" src/app/\(main\)/transactions/page.tsx && echo "BulkActions integrated"
make lint  # Should pass
```
  </verify>
  <done>
- BulkActions component exists with selection and action controls
- Component properly typed with TypeScript interface
- Main page imports and uses BulkActions
- All existing TEST_IDS preserved
- Lint passes
  </done>
</task>

<task type="auto">
  <name>Task 3: Extract data fetching to useTransactionData hook</name>
  <files>
    frontend/src/components/transactions/useTransactionData.ts
    frontend/src/components/transactions/index.ts
    frontend/src/app/(main)/transactions/page.tsx
  </files>
  <action>
Create frontend/src/components/transactions/useTransactionData.ts:
- Extract data fetching logic from TransactionsContent into custom hook
- Hook signature:
  ```typescript
  interface UseTransactionDataReturn {
    transactions: Transaction[]
    totalCount: number
    loading: boolean
    loadingMore: boolean
    hasMore: boolean
    bucketTags: Tag[]
    allTags: Tag[]
    accountTags: Tag[]
    occasionTags: Tag[]
    fetchTransactions: () => Promise<void>
    loadMore: () => Promise<void>
    setTransactions: (txns: Transaction[]) => void
  }

  export function useTransactionData(filters: FilterState): UseTransactionDataReturn
  ```
- Move all API calls: fetch transactions, load more (pagination), fetch tags (bucket, account, occasion, all)
- Handle cursor-based pagination logic
- Integrate with error handling from Plan 01 (toast notifications on fetch failures)
- Keep existing filter query construction logic
- Preserve debounced search behavior

Update frontend/src/components/transactions/index.ts:
- Add export for useTransactionData

Update frontend/src/app/(main)/transactions/page.tsx:
- Replace inline data fetching logic with useTransactionData hook
- Destructure hook return values
- Remove extracted useEffect and fetch functions (approximately 200-300 lines reduction)
- Keep only: filter state, UI orchestration, bulk action handlers, tag management

Verify final line count:
```bash
wc -l frontend/src/app/(main)/transactions/page.tsx  # Target: <500 lines
```
  </action>
  <verify>
```bash
cd frontend
test -f src/components/transactions/useTransactionData.ts && echo "useTransactionData hook exists"
wc -l src/components/transactions/useTransactionData.ts  # Should be ~150-250 lines
wc -l src/app/\(main\)/transactions/page.tsx  # Must be <500 lines
make lint  # Should pass
make build-frontend  # Should compile
make test-frontend  # All tests pass
```
  </verify>
  <done>
- useTransactionData hook exists with all data fetching logic
- Hook properly typed with TypeScript interfaces
- Main page uses hook and is under 500 lines
- All existing functionality preserved
- Build, lint, and tests pass
  </done>
</task>

</tasks>

<verification>
1. **DASH-04 (Page size):** Run `wc -l frontend/src/app/(main)/transactions/page.tsx` → result must be <500 lines
2. **Functionality preserved:** Manual testing
   - Filter by search, bucket, account, date range → correct results
   - Select multiple transactions, bulk tag → tags applied
   - Pagination (infinite scroll) → loads more transactions
   - All existing E2E tests pass (no modifications needed)
3. **Code quality:** Run full quality gate
   ```bash
   make lint           # Must pass
   make build-frontend # Must compile
   make test-frontend  # All tests pass
   make test-e2e       # E2E tests pass
   ```
</verification>

<success_criteria>
1. Transactions page.tsx reduced from 1323 lines to under 500 lines (>60% reduction)
2. TransactionFilters component extracted with ~200-300 lines
3. BulkActions component extracted with ~100-150 lines
4. useTransactionData hook extracted with ~150-250 lines
5. All existing functionality preserved (filters, pagination, bulk actions work identically)
6. All existing TEST_IDS preserved for E2E test compatibility
7. No TypeScript any assertions introduced
8. All quality gates pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-dashboard-polish-error-handling/08-02-SUMMARY.md`
</output>
