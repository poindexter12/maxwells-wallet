---
phase: 10-internationalization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/e2e/i18n-coverage.spec.ts
  - frontend/src/lib/i18n-audit.ts
autonomous: true
requirements:
  - I18N-03
  - TEST-04

must_haves:
  truths:
    - "Audit script identifies all hardcoded English strings in components"
    - "Pseudo-locale test loads pseudo.json and validates no untranslated strings in core flows"
    - "Test suite can be run locally and in CI"
  artifacts:
    - path: "frontend/e2e/i18n-coverage.spec.ts"
      provides: "Pseudo-locale E2E test validating translation coverage"
      min_lines: 50
    - path: "frontend/src/lib/i18n-audit.ts"
      provides: "Script to scan components for hardcoded strings"
      min_lines: 30
  key_links:
    - from: "frontend/e2e/i18n-coverage.spec.ts"
      to: "frontend/src/messages/pseudo.json"
      via: "Playwright locale switching to pseudo"
      pattern: "pseudo"
    - from: "frontend/src/lib/i18n-audit.ts"
      to: "frontend/src/components/**/*.tsx"
      via: "AST parsing or regex scanning"
      pattern: "scan.*tsx"
---

<objective>
Create i18n validation infrastructure to identify hardcoded strings and verify translation coverage.

Purpose: Establish automated testing that ensures no untranslated strings slip into production. Provides both development-time auditing (finding hardcoded strings) and runtime validation (pseudo-locale testing).

Output: Audit script for finding hardcoded strings + E2E test validating translation coverage using pseudo-locale.
</objective>

<execution_context>
@/Users/joe/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/messages/en-US.json
@frontend/src/test-ids/index.ts
@frontend/e2e/navigation.spec.ts
@docs/i18n-workflow.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create i18n audit script</name>
  <files>frontend/src/lib/i18n-audit.ts</files>
  <action>
Create TypeScript script that scans frontend/src/components/ for hardcoded English strings:

1. **Scan strategy:**
   - Parse .tsx files in frontend/src/components/
   - Detect JSX text nodes containing English words (not translation keys)
   - Detect string literals in title, aria-label, placeholder, alt attributes
   - Exclude: Test files (*.test.tsx), test IDs (data-testid), URLs, numbers, CSS classes, file paths

2. **Output format:**
   - Group findings by file
   - Show line number, component name, and the hardcoded string
   - Provide count summary at end

3. **Patterns to detect:**
   - JSX text: `<button>Click Here</button>` (not `<button>{t('common.save')}</button>`)
   - Attributes: `placeholder="Enter name"` (not `placeholder={t('...')}`)
   - String literals in render: `const label = "Save"` in component body

4. **False positive reduction:**
   - Ignore single-word technical terms (div, span, className, etc.)
   - Ignore camelCase identifiers
   - Ignore test ID values
   - Ignore empty strings or whitespace-only

5. **Execution:**
   - Can be run via `npx tsx src/lib/i18n-audit.ts` from frontend/
   - Accepts optional path argument to scan specific directory

Use Node.js fs module for file reading, simple regex patterns for detection (no need for full AST parser unless you want higher accuracy).
  </action>
  <verify>
Run the audit script:
```bash
cd frontend && npx tsx src/lib/i18n-audit.ts
```

Should output a report listing files with hardcoded strings (if any) and a summary count. Spot-check 2-3 reported strings to confirm they're legitimate hardcoded English (not false positives).
  </verify>
  <done>
Audit script exists, executes without errors, and produces a readable report identifying hardcoded strings in components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create pseudo-locale E2E test</name>
  <files>frontend/e2e/i18n-coverage.spec.ts</files>
  <action>
Create Playwright E2E test that validates translation coverage using pseudo-locale:

1. **Test setup:**
   - Generate pseudo-locale: Run `make translate-pseudo` or equivalent before test
   - Set locale cookie to 'pseudo' (or update URL/settings to switch to pseudo locale)
   - Load the app with pseudo-locale active

2. **Core flows to test (per I18N-03):**
   - Navigation: Visit Dashboard, Transactions, Budgets, Import, Admin, Tools, Organize pages
   - Page titles: Verify each page title is pseudo-translated (contains pseudo characters like Šåvé)
   - NavBar items: Verify all nav links show pseudo text
   - Modal buttons: Open a modal (e.g., help modal, budget creation), verify buttons are pseudo
   - Form labels: Check at least 2 forms (e.g., budget form, import form) for pseudo labels

3. **Detection logic:**
   - Helper function: `isPseudo(text: string)` returns true if text contains pseudo markers like `[`, `]`, accented chars (ÎñţļÐōמ)
   - For each checked element, assert that visible text passes `isPseudo()` check
   - If plain English detected, test fails with clear message: "Untranslated string found: {text} at {selector}"

4. **Use test IDs for element selection:**
   - Import TEST_IDS from '../src/test-ids'
   - Select elements via data-testid attributes (translation-agnostic)
   - Never rely on text content for selection

5. **Structure:**
   - One describe block: "i18n Coverage (Pseudo-Locale)"
   - Multiple test cases: "NavBar items are translated", "Page titles are translated", "Modal buttons are translated", etc.
   - Each test navigates to relevant page, selects elements by test ID, validates pseudo text

Reference existing E2E test patterns from frontend/e2e/navigation.spec.ts for Playwright setup and page navigation.
  </action>
  <verify>
Run the i18n coverage test:
```bash
cd frontend && npx playwright test e2e/i18n-coverage.spec.ts
```

Test should pass if pseudo-locale is properly applied across core UI surfaces. If test fails, output should clearly identify which elements have untranslated strings.
  </verify>
  <done>
E2E test exists, runs successfully, validates that NavBar items, page titles, modal buttons, and form labels use translation keys (show pseudo text when pseudo-locale is active).
  </done>
</task>

</tasks>

<verification>
- [ ] Audit script runs and produces hardcoded string report
- [ ] Pseudo-locale E2E test runs and validates translation coverage
- [ ] Both tools can identify untranslated strings
- [ ] Test IDs used for element selection (not text content)
</verification>

<success_criteria>
- Audit script successfully scans components and reports hardcoded strings with file/line numbers
- E2E test validates pseudo-locale coverage for NavBar, page titles, modals, and forms
- Both tools ready for use in Plan 10-02 to guide translation key migration
- Test framework established for I18N-03 and TEST-04 requirements
</success_criteria>

<output>
After completion, create `.planning/phases/10-internationalization/10-01-SUMMARY.md`
</output>
