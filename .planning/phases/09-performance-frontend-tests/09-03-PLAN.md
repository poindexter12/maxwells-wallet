---
phase: 09-performance-frontend-tests
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/transactions/TransactionFilters.test.tsx
  - frontend/src/components/transactions/BulkActions.test.tsx
  - frontend/src/components/transactions/useTransactionData.test.ts
  - frontend/src/components/import/SingleFileImport.test.tsx
  - frontend/src/components/import/BatchImport.test.tsx
  - frontend/src/components/import/ImportResult.test.tsx
autonomous: true
requirements: [TEST-02, TEST-03]

must_haves:
  truths:
    - "TransactionFilters component has tests for filter state changes and URL param handling"
    - "BulkActions component has tests for selection and bulk apply operations"
    - "useTransactionData hook has tests for pagination and data fetching"
    - "Import workflow components have tests for upload, preview, confirm, and error states"
  artifacts:
    - path: "frontend/src/components/transactions/TransactionFilters.test.tsx"
      provides: "Unit tests for transaction filters"
      min_lines: 80
    - path: "frontend/src/components/transactions/BulkActions.test.tsx"
      provides: "Unit tests for bulk actions"
      min_lines: 60
    - path: "frontend/src/components/transactions/useTransactionData.test.ts"
      provides: "Unit tests for transaction data hook"
      min_lines: 80
  key_links:
    - from: "frontend/src/components/transactions/*.test.tsx"
      to: "frontend/src/test-ids.ts"
      via: "Import TEST_IDS for element selection"
      pattern: "import.*TEST_IDS"
    - from: "frontend/src/components/import/*.test.tsx"
      to: "frontend/src/types/import.ts"
      via: "Mock import types for test data"
      pattern: "import.*ImportResult"
---

<objective>
Create unit tests for transaction page interactions (filter, sort, search, bulk actions) and import workflow UI states.

Purpose: Satisfy TEST-02 and TEST-03 requirements by ensuring transaction and import features are testable and maintainable.
Output: 6 new test files covering transactions and import workflows.
</objective>

<execution_context>
@/Users/joe/.claude/agents/gsd-executor.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-dashboard-polish-error-handling/08-02-SUMMARY.md
@frontend/src/components/transactions/TransactionFilters.tsx
@frontend/src/components/transactions/BulkActions.tsx
@frontend/src/components/transactions/useTransactionData.ts
@frontend/src/components/import/SingleFileImport.tsx
@frontend/src/components/import/BatchImport.tsx
@frontend/src/components/import/ImportResult.tsx
@frontend/src/test-ids.ts
@frontend/src/types/import.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create transaction component tests</name>
  <files>
    frontend/src/components/transactions/TransactionFilters.test.tsx
    frontend/src/components/transactions/BulkActions.test.tsx
    frontend/src/components/transactions/useTransactionData.test.ts
  </files>
  <action>
Create comprehensive tests for transaction page components extracted in Phase 8:

**TransactionFilters.test.tsx:**
```typescript
import { describe, it, expect, vi } from 'vitest'
import { render, screen, fireEvent } from '@testing-library/react'
import { TEST_IDS } from '@/test-ids'
import { TransactionFilters } from './TransactionFilters'

describe('TransactionFilters', () => {
  const mockProps = {
    filters: { search: '', bucket: '', occasion: '', accounts: [], accountsExclude: [], status: '', transfers: 'hide' as const, amountMin: '', amountMax: '', startDate: '', endDate: '' },
    searchInput: '',
    showAdvancedFilters: false,
    showAccountDropdown: false,
    bucketTags: [],
    occasionTags: [],
    accountTags: [],
    setSearchInput: vi.fn(),
    setFilters: vi.fn(),
    handleFilterChange: vi.fn(),
    handleQuickFilter: vi.fn(),
    handleInsightFilter: vi.fn(),
    removeFilter: vi.fn(),
    setShowAdvancedFilters: vi.fn(),
    setShowAccountDropdown: vi.fn(),
  }

  it('renders search input', () => {
    render(<TransactionFilters {...mockProps} />)
    expect(screen.getByTestId(TEST_IDS.FILTER_SEARCH)).toBeInTheDocument()
  })

  it('calls setSearchInput when search input changes', () => {
    render(<TransactionFilters {...mockProps} />)
    const input = screen.getByTestId(TEST_IDS.FILTER_SEARCH)
    fireEvent.change(input, { target: { value: 'coffee' } })
    expect(mockProps.setSearchInput).toHaveBeenCalledWith('coffee')
  })

  it('renders bucket filter dropdown', () => {
    render(<TransactionFilters {...mockProps} />)
    expect(screen.getByTestId(TEST_IDS.FILTER_BUCKET)).toBeInTheDocument()
  })

  it('renders quick date filters', () => {
    render(<TransactionFilters {...mockProps} />)
    // Assert "This Month", "Last Month", etc. buttons exist
  })

  it('toggles advanced filters when button clicked', () => {
    render(<TransactionFilters {...mockProps} />)
    const toggleBtn = screen.getByText(/advanced filters/i)
    fireEvent.click(toggleBtn)
    expect(mockProps.setShowAdvancedFilters).toHaveBeenCalledWith(true)
  })

  it('renders active filter pills', () => {
    const propsWithFilters = { ...mockProps, filters: { ...mockProps.filters, search: 'coffee', bucket: 'groceries' } }
    render(<TransactionFilters {...propsWithFilters} />)
    // Assert filter pills exist
  })

  it('calls removeFilter when pill close button clicked', () => {
    const propsWithFilters = { ...mockProps, filters: { ...mockProps.filters, search: 'coffee' } }
    render(<TransactionFilters {...propsWithFilters} />)
    // Find and click close button, assert removeFilter called
  })
})
```

**BulkActions.test.tsx:**
```typescript
describe('BulkActions', () => {
  const mockProps = {
    transactions: [{ id: 1, amount: -50, description: 'Coffee' }, { id: 2, amount: -100, description: 'Groceries' }],
    selectedIds: new Set([1]),
    allTags: [],
    bucketTags: [],
    occasionTags: [],
    accountTags: [],
    bulkAction: '',
    bulkValue: '',
    bulkLoading: false,
    handleSelectAll: vi.fn(),
    setSelectedIds: vi.fn(),
    setBulkAction: vi.fn(),
    setBulkValue: vi.fn(),
    handleBulkApply: vi.fn(),
  }

  it('renders select all checkbox', () => {
    render(<BulkActions {...mockProps} />)
    expect(screen.getByRole('checkbox')).toBeInTheDocument()
  })

  it('shows selected count when items selected', () => {
    render(<BulkActions {...mockProps} />)
    expect(screen.getByText(/1 selected/i)).toBeInTheDocument()
  })

  it('renders bulk action dropdowns', () => {
    render(<BulkActions {...mockProps} />)
    // Assert bucket/occasion/account dropdowns exist
  })

  it('calls handleBulkApply when apply button clicked', () => {
    const propsWithAction = { ...mockProps, bulkAction: 'bucket', bulkValue: 'groceries' }
    render(<BulkActions {...propsWithAction} />)
    const applyBtn = screen.getByText(/apply/i)
    fireEvent.click(applyBtn)
    expect(mockProps.handleBulkApply).toHaveBeenCalled()
  })

  it('disables apply button when bulkLoading=true', () => {
    const propsWithLoading = { ...mockProps, bulkLoading: true, bulkAction: 'bucket', bulkValue: 'groceries' }
    render(<BulkActions {...propsWithLoading} />)
    expect(screen.getByText(/applying/i)).toBeInTheDocument()
  })
})
```

**useTransactionData.test.ts:**
```typescript
describe('useTransactionData', () => {
  it('fetches transactions on mount', async () => {
    const { result } = renderHook(() => useTransactionData({ filters: {}, filtersInitialized: true, debouncedFilters: '{}' }))
    // Assert fetch called
  })

  it('fetches tags in parallel', async () => {
    // Assert Promise.all pattern for bucket/occasion/account tags
  })

  it('loads more transactions when loadMoreTransactions called', async () => {
    // Assert cursor-based pagination
  })

  it('cancels in-flight requests on unmount', async () => {
    // Assert AbortController behavior
  })
})
```

Focus on user interactions and data flow, not implementation details. Use data-testid for all element selection.
  </action>
  <verify>
    Run `make test-frontend` — transaction component tests pass
  </verify>
  <done>
    TransactionFilters, BulkActions, and useTransactionData tests exist and pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Create import workflow tests</name>
  <files>
    frontend/src/components/import/SingleFileImport.test.tsx
    frontend/src/components/import/BatchImport.test.tsx
    frontend/src/components/import/ImportResult.test.tsx
  </files>
  <action>
Create tests for import workflow UI states (upload, preview, confirm, error):

**Update SingleFileImport.test.tsx** (already exists, expand coverage):
```typescript
describe('SingleFileImport', () => {
  it('renders file upload dropzone', () => {
    // Assert dropzone exists
  })

  it('shows preview after file upload', async () => {
    // Mock file upload, assert preview shown
  })

  it('displays error when upload fails', async () => {
    // Mock failed upload, assert error message shown
  })

  it('renders account selection dropdown', () => {
    // Assert account dropdown exists
  })

  it('renders format hint dropdown', () => {
    // Assert format hint dropdown exists
  })

  it('disables import button when no file selected', () => {
    // Assert import button disabled
  })

  it('shows loading state during import', async () => {
    // Mock import in progress, assert loading spinner shown
  })
})
```

**BatchImport.test.tsx** (new file):
```typescript
describe('BatchImport', () => {
  it('renders file list after multiple files uploaded', () => {
    // Mock multiple file upload, assert file list shown
  })

  it('shows preview for each file', () => {
    // Assert each file has preview
  })

  it('allows removing files from batch', () => {
    // Mock remove action, assert file removed from list
  })

  it('displays progress during batch import', () => {
    // Mock import progress, assert progress indicator shown
  })

  it('shows error for failed file imports', () => {
    // Mock partial failure, assert error shown for failed files
  })
})
```

**Update ImportResult.test.tsx** (already exists, expand coverage):
```typescript
describe('ImportResult', () => {
  it('renders success state with transaction count', () => {
    const result = { success: true, transactions_imported: 50, duplicates_skipped: 5 }
    render(<ImportResult result={result} />)
    expect(screen.getByTestId(TEST_IDS.IMPORT_RESULT)).toBeInTheDocument()
    expect(screen.getByText(/50.*imported/i)).toBeInTheDocument()
  })

  it('renders error state with error message', () => {
    const result = { success: false, error: 'Invalid file format' }
    render(<ImportResult result={result} />)
    expect(screen.getByText(/invalid file format/i)).toBeInTheDocument()
  })

  it('shows duplicates skipped count when present', () => {
    const result = { success: true, transactions_imported: 50, duplicates_skipped: 10 }
    render(<ImportResult result={result} />)
    expect(screen.getByText(/10.*duplicate/i)).toBeInTheDocument()
  })

  it('renders import another file button', () => {
    const result = { success: true, transactions_imported: 50 }
    render(<ImportResult result={result} />)
    expect(screen.getByText(/import another/i)).toBeInTheDocument()
  })
})
```

Cover upload, preview, confirm, error states as specified in TEST-03. Use existing test patterns from ImportResult.test.tsx.
  </action>
  <verify>
    Run `make test-frontend` — import workflow tests pass
  </verify>
  <done>
    SingleFileImport, BatchImport, and ImportResult tests exist with expanded coverage for all workflow states
  </done>
</task>

</tasks>

<verification>
- [ ] TransactionFilters.test.tsx exists and passes
- [ ] BulkActions.test.tsx exists and passes
- [ ] useTransactionData.test.ts exists and passes
- [ ] SingleFileImport.test.tsx expanded with upload/preview/error coverage
- [ ] BatchImport.test.tsx created with batch workflow coverage
- [ ] ImportResult.test.tsx expanded with all result state coverage
- [ ] All tests use data-testid for element selection
- [ ] `make test-frontend` passes
- [ ] Build succeeds: `make build-frontend`
</verification>

<success_criteria>
1. Transaction filters, sorting, and search have unit tests
2. Bulk actions have unit tests
3. Transaction data fetching hook has unit tests
4. Import workflow has tests for upload, preview, confirm, and error states
5. TEST-02 and TEST-03 requirements satisfied
6. Frontend test coverage maintained or improved
</success_criteria>

<output>
After completion, create `.planning/phases/09-performance-frontend-tests/09-03-SUMMARY.md`
</output>
