---
phase: 10-internationalization
plan: 03
type: execute
wave: 3
depends_on:
  - 10-01
  - 10-02
files_modified:
  - .github/workflows/ci.yaml
  - frontend/package.json
  - frontend/vitest.config.ts
autonomous: true
requirements:
  - I18N-03
  - TEST-04

must_haves:
  truths:
    - "Pseudo-locale E2E test validates no untranslated strings remain in core flows"
    - "i18n test suite runs in CI pipeline"
    - "CI fails if new hardcoded strings are introduced"
  artifacts:
    - path: ".github/workflows/ci.yaml"
      provides: "CI job running i18n coverage test"
      contains: "i18n-coverage"
    - path: "frontend/vitest.config.ts"
      provides: "Test configuration including i18n tests"
      contains: "test"
  key_links:
    - from: ".github/workflows/ci.yaml"
      to: "frontend/e2e/i18n-coverage.spec.ts"
      via: "Playwright test execution in CI"
      pattern: "playwright test.*i18n-coverage"
---

<objective>
Validate translation coverage with pseudo-locale testing and enable i18n test suite in CI to prevent regression.

Purpose: Complete I18N-03 by confirming no untranslated strings remain in core flows. Complete TEST-04 by enabling i18n tests in CI pipeline to catch future regressions. Provides continuous validation that translation coverage is maintained.

Output: Passing pseudo-locale E2E test + CI integration preventing introduction of hardcoded strings.
</objective>

<execution_context>
@/Users/joe/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joe/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-internationalization/10-01-SUMMARY.md
@.planning/phases/10-internationalization/10-02-SUMMARY.md
@frontend/e2e/i18n-coverage.spec.ts
@.github/workflows/ci.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Validate pseudo-locale coverage</name>
  <files>frontend/src/messages/pseudo.json</files>
  <action>
**Step 1: Generate fresh pseudo-locale:**
```bash
make translate-pseudo
```
Or equivalent command (from frontend/: `npm run translate:pseudo` if script exists, otherwise run the pseudo generation tool).

**Step 2: Run the i18n coverage E2E test:**
```bash
cd frontend && npx playwright test e2e/i18n-coverage.spec.ts --headed
```

**Step 3: Analyze results:**
- If test passes: Translation coverage is complete for tested flows
- If test fails: Identify which elements still have untranslated strings
  - Read Playwright output for specific failures (element selector + untranslated text)
  - For each failure, identify the source component
  - Check if component needs additional translation keys
  - If missing keys: add to en-US.json and update component (minimal fixes)
  - If test logic issue: adjust test to properly detect pseudo-locale

**Step 4: Iterate until test passes:**
- Fix any remaining hardcoded strings found by the test
- Re-run test to confirm fixes
- Repeat until all core flows pass pseudo-locale validation

**Core flows that must pass (per I18N-03):**
- NavBar items display pseudo text
- Page titles display pseudo text (Dashboard, Transactions, Budgets, Import, Admin, Tools, Organize)
- Modal buttons display pseudo text (at least help modal, budget modal, import modal)
- Form labels display pseudo text (transaction filters, import form, budget form)

**Success criteria for this task:**
```bash
cd frontend && npx playwright test e2e/i18n-coverage.spec.ts
```
Returns exit code 0 (all tests pass).
  </action>
  <verify>
Run the full i18n coverage test suite:
```bash
cd frontend && npx playwright test e2e/i18n-coverage.spec.ts
```

All tests should pass. Output should confirm:
- NavBar items are translated
- Page titles are translated
- Modal buttons are translated
- Form labels are translated

No failures indicating untranslated strings in core flows.
  </verify>
  <done>
Pseudo-locale E2E test passes completely, validating that NavBar items, page titles, modal buttons, and form labels use translation keys. I18N-03 requirement satisfied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enable i18n tests in CI</name>
  <files>.github/workflows/ci.yaml</files>
  <action>
Add i18n coverage test to CI pipeline to prevent regression:

**Step 1: Locate the E2E test job in .github/workflows/ci.yaml**

Find the existing Playwright E2E test step (likely in a `frontend` or `test` job).

**Step 2: Add i18n coverage test step**

Add a new step to run the i18n coverage test specifically:

```yaml
- name: Run i18n coverage tests
  working-directory: frontend
  run: |
    npx playwright test e2e/i18n-coverage.spec.ts
```

**Step 3: Ensure pseudo-locale is generated before test**

Add pseudo-locale generation step before the i18n test (if not already generated in setup):

```yaml
- name: Generate pseudo-locale
  working-directory: frontend
  run: make translate-pseudo || npm run translate:pseudo || npx tsx scripts/generate-pseudo.ts
```

**Step 4: Position in CI workflow**

Place the i18n test after:
- Dependencies are installed
- Frontend is built
- Playwright is installed

But it can run in parallel with or before other E2E tests (independent test).

**Step 5: Configure test failure behavior**

Ensure CI fails if i18n tests fail (default Playwright behavior). This prevents merging code with untranslated strings.

**Alternative: Add to existing E2E test suite**

If CI already runs all E2E tests with a single command (e.g., `npx playwright test`), the i18n-coverage.spec.ts will automatically be included. In this case, just ensure pseudo-locale is generated before E2E tests run.

**Verify CI configuration:**
- Check that test command includes e2e/i18n-coverage.spec.ts (explicitly or via wildcard)
- Check that pseudo.json exists or is generated before tests
- Check that CI fails on test failure (not continue-on-error for i18n tests)
  </action>
  <verify>
**Local simulation of CI:**
```bash
cd frontend
rm -rf node_modules/.cache  # Clear any cached test data
npm ci  # Clean install like CI does
make translate-pseudo  # Generate pseudo-locale
npx playwright test e2e/i18n-coverage.spec.ts  # Run i18n tests
```

Should pass with exit code 0.

**After committing CI changes:**
Push to a branch and observe CI run. Verify that:
1. i18n coverage test runs in CI (check logs)
2. Test passes in CI environment
3. CI would fail if test fails (simulate by temporarily breaking a translation key and pushing - CI should catch it)

**Quick CI check:**
Look at .github/workflows/ci.yaml diff to confirm i18n test step is present and properly configured.
  </verify>
  <done>
CI pipeline includes i18n coverage test that runs on every PR. Test validates pseudo-locale coverage for core flows. CI fails if untranslated strings are introduced. TEST-04 requirement satisfied.
  </done>
</task>

</tasks>

<verification>
- [ ] Pseudo-locale E2E test passes completely (I18N-03)
- [ ] No untranslated strings in NavBar, page titles, modal buttons, form labels
- [ ] i18n coverage test runs in CI pipeline (TEST-04)
- [ ] CI fails if hardcoded strings are introduced (regression prevention)
- [ ] All Phase 10 requirements satisfied (I18N-01, I18N-02, I18N-03, TEST-04)
</verification>

<success_criteria>
- Pseudo-locale test validates complete translation coverage for core user flows (I18N-03 satisfied)
- i18n test suite enabled in CI with pseudo-locale generation (TEST-04 satisfied)
- CI provides automated regression prevention for i18n coverage
- Phase 10 complete: All user-facing text uses translation keys with automated validation
- Ready to merge and ship with confidence that translations are complete
</success_criteria>

<output>
After completion, create `.planning/phases/10-internationalization/10-03-SUMMARY.md`
</output>
